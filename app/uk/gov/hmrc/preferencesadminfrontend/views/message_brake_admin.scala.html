@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.govukfrontend.views.html.components._
@import uk.gov.hmrc.govukfrontend.views.html.components.implicits._
@import uk.gov.hmrc.preferencesadminfrontend.config.AppConfig
@import uk.gov.hmrc.preferencesadminfrontend.controllers.routes
@import uk.gov.hmrc.preferencesadminfrontend.model.{GmcBatch,BatchMessagePreview}
@import uk.gov.hmrc.preferencesadminfrontend.views.TemplateHelper


@this(
layout: Layout,
form: FormWithCSRF,
govukButton: GovukButton,
govukInput: GovukInput,
govukBreadcrumbs: GovukBreadcrumbs)
@(batchList: Seq[GmcBatch], batchMessagePreview: Option[BatchMessagePreview] = None)(implicit request: Request[_], messages: Messages, appConfig: AppConfig)

@layout(pageTitle = Some("Unverified Message Request FormIDs")) {

    @govukBreadcrumbs(Breadcrumbs(
        items = Seq(
            BreadcrumbsItem(
                content = Text("Home"),
                href = Some("/paperless/admin/home")
            ),
            BreadcrumbsItem(
                content = Text("Message Brake"),
                href = Some("#")
            )
        )
    ))

    <table class="govuk-table">
        <caption class="govuk-table__caption govuk-table__caption--l">Unverified Message Request FormIDs</caption>
        <thead class="govuk-table__head">
        <tr class="govuk-table__row">
            <th scope="col" class="govuk-table__header">FormID</th>
            <th scope="col" class="govuk-table__header">Batch No</th>
            <th scope="col" class="govuk-table__header">Issue Date</th>
            <th scope="col" class="govuk-table__header">Count</th>
            <th scope="col" class="govuk-table__header">Email Template ID</th>
            <th></th>
        </tr>
        </thead>
        <tbody class="govuk-table__body">
            @for(batch <- batchList) {
                <tr class="govuk-table__row">
                    <th scope="row" class="govuk-table__header">@batch.formId</th>
                    <td class="govuk-table__cell">@batch.batchId</td>
                    <td class="govuk-table__cell">@batch.issueDate</td>
                    <td class="govuk-table__cell">@batch.count</td>
                    <td class="govuk-table__cell">@batch.templateId</td>
                    <td>
                        @form(action = routes.MessageBrakeController.previewMessage) {
                            <input type="hidden" name="batchId" value="@batch.batchId"/>
                            <input type="hidden" name="formId" value="@batch.formId"/>
                            <input type="hidden" name="issueDate" value="@batch.issueDate"/>
                            <input type="hidden" name="templateId" value="@batch.templateId"/>
                            @govukButton(Button(
                                name = Some("preview"),
                                content = Text("Preview")
                            ))
                        }
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <div class="grid-row">
        @batchMessagePreview match {
            case Some(batchPreview) => {
                <div class="column-full">
                    <div class="form-group">
                        <h2>Message Preview</h2>
                        <div class="message-preview">@batchPreview.getContentHtml</div>
                        @{form(action = routes.MessageBrakeController.previewMessage) {
                            TemplateHelper.getFormButton("preview","Preview Next",batchList,batchPreview.batchId)
                        }}
                    </div>
                </div>
                <div class="column-full">
                    <table class="govuk-table">
                        <tbody class="govuk-table__body">
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell">External Ref ID</td>
                                <td class="govuk-table__cell">@batchPreview.message.externalRefId</td>
                            </tr>
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell">MessageType</td>
                                <td class="govuk-table__cell">@batchPreview.message.messageType</td>
                            </tr>
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell">Subject</td>
                                <td class="govuk-table__cell">@{Html(batchPreview.message.subject)}</td>
                            </tr>
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell">Issue Date</td>
                                <td class="govuk-table__cell">@batchPreview.message.issueDate</td>
                            </tr>
                            <tr class="govuk-table__row">
                                <td class="govuk-table__cell">Tax Identifier Name</td>
                                <td class="govuk-table__cell">@batchPreview.message.taxIdentifierName</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="column-full">
                    <div class="button-group">
                        @form(action = routes.MessageBrakeController.showApproveBatchConfirmationPage(), 'class -> "button-form") {
                            @TemplateHelper.getFormButton("approve", "Approve", batchList, batchPreview.batchId)
                        }
                        @form(action = routes.MessageBrakeController.showRejectBatchConfirmationPage(), 'class -> "button-form") {
                            @TemplateHelper.getFormButton("reject", "Reject", batchList, batchPreview.batchId, "govuk-button govuk-button--warning")
                        }
                    </div>
                </div>
            }
            case None => {}
        }
    </div>

}